<% content_for(:title) { "Dashboard" } %>

<!-- Stats Grid -->
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-label">Total Members</div>
    <div class="stat-value"><%= @total_members %></div>
    <div class="stat-change positive">All registered users</div>
  </div>
  
  <div class="stat-card green">
    <div class="stat-label">Active Members</div>
    <div class="stat-value"><%= @active_members %></div>
    <div class="stat-change positive"><%= @total_members > 0 ? ((@active_members.to_f / @total_members) * 100).round(1) : 0 %>% of total</div>
  </div>
  
  <div class="stat-card blue">
    <div class="stat-label">New This Month</div>
    <div class="stat-value"><%= @new_signups_30_days %></div>
    <div class="stat-change"><%= @new_signups_7_days %> in last 7 days</div>
  </div>
  
  <div class="stat-card purple">
    <div class="stat-label">Expired</div>
    <div class="stat-value"><%= @expired_members %></div>
    <div class="stat-change negative">Need renewal outreach</div>
  </div>
</div>

<!-- Two Column Layout -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
  
  <!-- Members by Plan -->
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Members by Plan</h3>
    </div>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Plan</th>
            <th style="text-align: right;">Members</th>
            <th style="text-align: right;">Share</th>
          </tr>
        </thead>
        <tbody>
          <% total = @members_by_plan.values.sum %>
          <% plan_colors = { 'Basic' => '#3b82f6', 'Quarterly' => '#8b5cf6', 'Premium' => '#ef4444', 'Elite' => '#f59e0b' } %>
          <% @members_by_plan.each do |plan_name, count| %>
            <tr>
              <td>
                <div style="display: flex; align-items: center; gap: 10px;">
                  <div style="width: 10px; height: 10px; border-radius: 50%; background: <%= plan_colors[plan_name] || '#6b7280' %>;"></div>
                  <span style="font-weight: 600; color: white;"><%= plan_name %></span>
                </div>
              </td>
              <td style="text-align: right; font-weight: 700; color: white;"><%= count %></td>
              <td style="text-align: right; color: #9ca3af;"><%= total > 0 ? ((count.to_f / total) * 100).round(1) : 0 %>%</td>
            </tr>
          <% end %>
          <% if @members_by_plan.empty? %>
            <tr>
              <td colspan="3" style="text-align: center; color: #6b7280; padding: 24px;">No memberships yet</td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
  
  <!-- Expiring Soon -->
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Expiring Soon</h3>
      <span class="badge badge-warning">Next 7 days</span>
    </div>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Member</th>
            <th>Plan</th>
          </tr>
        </thead>
        <tbody>
          <% @expiring_soon.each do |user| %>
            <tr>
              <td>
                <div style="display: flex; align-items: center; gap: 12px;">
                  <div style="width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, #ef4444, #dc2626); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; color: white;">
                    <%= user.name.first.upcase %>
                  </div>
                  <div>
                    <div style="font-weight: 600; color: white;"><%= user.name %></div>
                    <div style="font-size: 12px; color: #6b7280;"><%= user.email %></div>
                  </div>
                </div>
              </td>
              <td>
                <span class="badge badge-warning"><%= user.plan&.name || 'N/A' %></span>
              </td>
            </tr>
          <% end %>
          <% if @expiring_soon.empty? %>
            <tr>
              <td colspan="2" style="text-align: center; color: #6b7280; padding: 24px;">No memberships expiring soon</td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Recent Signups -->
<div class="card" style="margin-top: 24px;">
  <div class="card-header">
    <h3 class="card-title">Recent Signups</h3>
    <%= link_to "View All", admin_users_path, class: "btn btn-secondary", style: "padding: 8px 16px; font-size: 13px;" %>
  </div>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Member</th>
          <th>Plan</th>
          <th>Status</th>
          <th>Joined</th>
          <th style="text-align: right;">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @recent_signups.each do |user| %>
          <tr>
            <td>
              <div style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #3b82f6, #6366f1); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px; color: white;">
                  <%= user.name.first.upcase %>
                </div>
                <div>
                  <div style="font-weight: 600; color: white;"><%= user.name %></div>
                  <div style="font-size: 12px; color: #6b7280;"><%= user.email %></div>
                </div>
              </div>
            </td>
            <td>
              <% plan_name = user.plan&.name || 'No Plan' %>
              <% badge_class = case plan_name
                when 'Elite' then 'badge-warning'
                when 'Premium' then 'badge-danger'
                when 'Quarterly' then 'badge-info'
                else 'badge-info'
              end %>
              <span class="badge <%= badge_class %>"><%= plan_name %></span>
            </td>
            <td>
              <% if user.active_membership? %>
                <span class="badge badge-success">Active</span>
              <% else %>
                <span class="badge badge-danger">Expired</span>
              <% end %>
            </td>
            <td style="color: #9ca3af; font-size: 13px;">
              <%= user.created_at.strftime("%b %d, %Y") %>
            </td>
            <td style="text-align: right;">
              <%= link_to "View", admin_user_path(user), class: "btn btn-secondary", style: "padding: 6px 12px; font-size: 12px;" %>
            </td>
          </tr>
        <% end %>
        <% if @recent_signups.empty? %>
          <tr>
            <td colspan="5" style="text-align: center; color: #6b7280; padding: 32px;">
              <div style="margin-bottom: 8px;">No members yet</div>
              <div style="font-size: 13px;">New signups will appear here</div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<!-- Quick Actions -->
<div class="card" style="margin-top: 24px;">
  <div class="card-header">
    <h3 class="card-title">Quick Actions</h3>
  </div>
  <div style="display: flex; gap: 16px; flex-wrap: wrap;">
    <%= link_to admin_users_path, class: "btn btn-primary" do %>
      <svg style="width: 18px; height: 18px; margin-right: 8px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
      Manage Members
    <% end %>
    <%= link_to admin_memberships_path, class: "btn btn-secondary" do %>
      <svg style="width: 18px; height: 18px; margin-right: 8px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path></svg>
      View Memberships
    <% end %>
    <%= link_to admin_plans_path, class: "btn btn-secondary" do %>
      <svg style="width: 18px; height: 18px; margin-right: 8px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
      Manage Plans
    <% end %>
    <%= link_to admin_testimonials_path, class: "btn btn-secondary" do %>
      <svg style="width: 18px; height: 18px; margin-right: 8px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
      Testimonials
    <% end %>
  </div>
</div>
